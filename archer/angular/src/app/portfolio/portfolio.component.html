<ng-container *ngIf="userObs | async as user">
  <div class="portfolio_container" *ngIf="userAssetsObs | async as userAssets">
    <div class="zero_state"></div>
    <div class="portfolio">
      <div class="container">
        <div class="global_portfolio_section">
          <div class="title">Global Portfolio</div>
          <div class="totals">
            <div class="portfolio_value gain">{{getPortfolioValue(userAssets) | currency: 'USD'}}</div>
            <div class="change_since_yesterday"
                 [ngClass]="changePercent > 0 ? 'gain gain_bg' : 'lose lose_bg' "
                 *ngVar="getPortfolioChange(userAssets) as changePercent">
              <span class="value">{{changePercent >= 0 ? '+' : '' }}{{getPortfolioChange(userAssets)}}%</span>
              <mat-icon svgIcon="up_arrow" class="arrow"></mat-icon>
            </div>
            <!--<div class="updated_at">At close: March 10 04:00 PM EST</div>-->
          </div>
        </div>

        <div class="chart_and_controls_container" *ngIf="portfolioValueHistoryObs | async as portfolioValueHistory">
          <div class="chart_container">
            <chart [chart]="getPortfolioChart(portfolioValueHistory)"></chart>
          </div>
          <div class="controls">
            <button class="control_button" mat-flat-button
                    *ngFor="let timeFrame of allTimeFrames"
                    (click)="selectedTimeFrame.next(timeFrame)"
                    [ngClass]="{selected: selectedTimeFrame.value === timeFrame}">

              {{timeFrame | uppercase}}
            </button>
          </div>
        </div>

        <div class="health_and_diversity">
          <div class="title">Portfolio Health & Diversity</div>
          <div class="stats">
            <div class="stat">
              <div class="stat_name">Total gain</div>
              <div class="stat_value" [ngClass]="totalGainPercent >= 0 ? 'gain' : 'lose'"
                   *ngVar="getTotalGainPercent(userAssets) as totalGainPercent">
                {{getTotalGain(userAssets) | currency: 'USD'}}
                ({{totalGainPercent > 0 ? '+' : ''}}{{totalGainPercent}}%)
              </div>
            </div>
            <div class="stat">
              <div class="stat_name">Cash holding</div>
              <div class="stat_value gain">{{user.balance | currency: 'USD'}}</div>
            </div>
            <div class="stat">
              <div class="stat_name">Total shares</div>
              <div class="stat_value gain"> {{ getTotalStockQuantity(userAssets) }} / {{userAssets.length}} holdings
              </div>
            </div>
          </div>
          <ng-container *ngIf="getAllocationsPerIndustry(userAssets) as allocArray">
            <div class="progress_bar_container">
              <div class="single_progress_bar" [ngClass]="'color'+(index + 1)"
                   *ngFor="let alloc of allocArray; let index = index" [style.width]="alloc.percentage + '%'"></div>
            </div>
            <div class="progress_bar_tags">
              <div class="tag" *ngFor="let alloc of allocArray; let index = index">
                <div class="bullet" [ngClass]="'color'+(index + 1)"></div>
                <div class="tag_text"><span class="description">{{alloc.sicDescription | titlecase}}</span> <span
                  class="bold">{{alloc.percentage.toFixed(2)}}
                  %</span></div>
              </div>
            </div>
          </ng-container>
        </div>

        <div class="assets_table">
          <div class="row header">
            <div class="cell">Symbol</div>
            <div class="cell">Last price</div>
            <div class="cell">Change</div>
            <div class="cell">Change %</div>
            <div class="cell">Shares</div>
            <div class="cell">Total value</div>
          </div>
          <div class="row" *ngFor="let userAsset of userAssets">
            <div class="cell">{{userAsset.tickerId}}</div>
            <div class="cell">{{userAsset.ticker.closePrice}}</div>
            <ng-container *ngVar="userAsset.ticker.todaysChange as change">
              <div class="cell bold"
                   [ngClass]="change >= 0 ? 'gain' : 'lose'">{{change >= 0 ? '+' : ''}}{{change.toFixed(2)}}</div>
              <div class="cell bold"
                   [ngClass]="change >= 0 ? 'gain' : 'lose'">{{change >= 0 ? '+' : ''}}{{userAsset.ticker.todaysChangePerc.toFixed(2)}}
                %
              </div>
            </ng-container>
            <div class="cell">{{userAsset.quantity}}</div>
            <div class="cell">{{userAsset.quantity * userAsset.ticker.closePrice | currency: 'USD'}}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>
